
uvicorn src.api.main:app --host 0.0.0.0 --port 8000

http://127.0.0.1:8000/health/env  ---GET   环境检查
http://127.0.0.1:8000/action/qvx_max_and_top   --POST 置顶并最大化
http://127.0.0.1:8000/action/send   -- POST 发送消息动作（加了仿真）



GET /health/env

输入：无
输出：JSON：{ ok: bool, detail: object, screenshot_url: "/health/screenshot" }
作用：做环境自检（操作系统/分辨率/企微状态等），用于确认服务是否具备可运行条件
GET /health/screenshot

输入：无
输出：image/png（桌面实时截图文件流，带禁缓存头）
作用：获取当前桌面截图，便于远程查看“此刻屏幕画面”用于排查定位/界面状态
POST /action/qvx_max_and_top

输入：无
输出：JSON：{ success: true, screenshot: string, window: object }；失败返回 500 + detail
作用：将企业微信窗口激活、最大化并置顶，并返回一次截图和窗口信息
POST /action/send

输入：无
输出：JSON：{ success: true, screenshot: string, debug: object }；失败返回 500 + detail: { message, debug }
作用：发送消息动作（当前实现是：聚焦输入框并点击发送按钮；优先用内存缓存坐标，缺失才截图+模板匹配）
GET /debug/windows/wecom

输入：无
输出：JSON：包含候选窗口列表（hwnd/title/pid/rect/是否前台/是否最大化/是否置顶等）
作用：调试用，查看当前系统里识别到的企微窗口候选情况
GET /debug/context

输入：无
输出：JSON：运行时上下文快照：p_screen_size、l_screen_size、input_center_position、send_button_position、meta
作用：调试用，查看守护线程与定位缓存是否正常更新、最近错误等


我要给RPA开发一些http后台接口，用于操控企业微信
写代码前，我先表达下我的偏好
a. 需要用中文给我交互
b. 代码要满足设计模式的，开闭原则，新功能增加以新增py文件为主，尽量避免代码里有一堆的if嵌套
c. 代码是给初级程序员维护的，所以不要做多行合并到1行，这种是严令禁止的，代码要有注释，代码要用简单的语法表达
d. 所有功能函数，必须给我设计测试用例，测试用例包括正，负向用例


1. env_check
   功能：检查运行环境是否符合要求。条件包括：【操作系统类型校验- 包括windows server系列，win10，win11】【企业微信要已经启动】是and关系
   输入：无
   输出：
        参数1 boolean类型，是否符合最小可用的标准
        参数2 字典类型， 环境描述
          【key1-屏幕分辨率】    屏幕实际分辨率 例如: [1920,1080]
          【key2-操作系统类型】 操作系统实际类型，需要到具体，例如 win10，win11，winserver2003
          【key3-企微是否启动】 已安装-启动，已安装-未启动，未安装
           【key4-本次检查桌面截图位置】需要对当前桌面进行截图，便于后续分析



2.qvx_position  
   功能：定位各种元素，的box（元素所在屏幕的4点矩形坐标）
   做法：项目目录增加1个template，按常见屏幕分辨率，设置目录 例如 1920-1200  ，800-600，你来帮我扩展，我是按env实际分辨率，在这些目录里找模版，用opencv做以图搜图
   输入：
            参数1：标的物  例如  消息输入框，消息发送按钮，等  
                     
   输出：
           参数1： bbox ，列表-包括左上坐标，宽，高

3. qvx_action_sendmsg
    功能：找到input输入框，使用alt+s 或者  点击发送按钮,如果是用点击，需要采用仿真模式移动鼠标。
    仿真代码我已经写好了，在
    输入：无
    输出：
         参数1 ：boolean 类型  反应动作是否执行
         参数2： 发送完毕后，需要截图，保留日志  （依赖全局参数  screen_send_msg_after ）  


4. 企业微信客户端，做了风控，对于rpa会有风控，我做了基于profile的键盘鼠标仿真
    代码都在rpa代码目录里，你先给我生成空目录，后面我copy进来，你再理解，然后用于 qvx_action_sendmsg


5. qvx_max_and_top
    功能：把企业微信最大化并置顶
    输入：无
    输出：
        参数1： 截图位置  （依赖全局参数  screen_max_and_top ）  

